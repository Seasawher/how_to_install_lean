# Lake: Leanビルドシステム編

**Lake**(Lean Make)はLean 4のためのビルドシステム兼パッケージマネージャです。Lakeを使うと、Leanパッケージを作ることができ、そしてLeanパッケージの設定をLean自体で書くことができます。Leanパッケージの設定はパッケージのルートディレクトリの ``lakefile.lean`` というファイルに保存されます。

``lakefile.lean`` は、パッケージの基本設定を定義する ``package`` 宣言を含みます。また、通常、Leanライブラリやバイナリ実行ファイルなどのためのビルド設定と、コマンドラインでコマンド ``lake script run`` によって実行されるLeanスクリプト宣言も含みます。

この章では、Lakeのビルドシステムとしての側面に焦点を当てます。

(後日更新予定)

<!--
## Lakeに関する用語集 (他の記述より、訳語や訳内容が不正確な可能性が高いです)

ここではビルドに関する用語に絞って紹介します。

* *target*(**ターゲット**)は**Lakeにおけるビルド対象の基本単位**です(タクティク証明におけるターゲットとは全く異なります)。パッケージはいくつでもターゲットを定義することができます。各ターゲットには名前があり、その名前は(コマンド ``lake build <target_name>`` を使って)Lakeにターゲットのビルドを指示したり、ターゲットのビルド状況を内部的に追跡するために使われます。Lakeはビルトインのターゲット型を3つ(Leanライブラリ、バイナリ実行ファイル、他言語ライブラリ)定義していますが、ユーザーは独自のカスタムターゲット型を定義することもできます。複雑な型(パッケージ、ライブラリ、モジュール)には複数のファセットがあり、それぞれが別個のビルド可能なターゲットとしてみなされます。

* *Lean library*(**Leanライブラリ**)は単一の設定を共有するモジュールの集まりです。ライブラリに含まれるモジュールはそのソースディレクトリ、*module roots*の集まり、*module globs*の集まりによって定義されます。

* *Lean binary executable*(**Leanバイナリ実行ファイル**)は、*root*(**ルート**)と呼ばれる、``main`` 定義を持つLeanモジュールからビルドされるファイルです。これは、Leanがインストールされていないコンピュータ上でも実行可能なバイナリ実行ファイルです。

* *external library*(**外部言語ライブラリ**)は、パッケージ内のLeanコードが機能するために必要とする、外部言語(C言語など)のネイティブかつ静的なライブラリです。例えば、パッケージ内のLeanコードは ``@[extern]`` を使って外部言語で書かれたコードを呼び出すことがあります。``extern_lib`` ターゲットは、外部言語ライブラリが必要であることをLakeに伝え、必要な外部言語ライブラリをビルドする方法をLakeに指示するために使われます。Lakeは、Leanコードが、必要とする外部言語関数(より厳密には、外部言語シンボル)にアクセスできるように、適切な時に外部言語ライブラリを自動的にリンクします。

* *facet*(**ファセット**)は、他の組織単位(パッケージ、モジュール、ライブラリ)からビルドされる要素のことです。例えば、Lakeは一つのモジュールから ``olean``、``ilean``、``c``、``o`` ファイルを生成します。これらの各要素はモジュールのファセットと呼ばれます。同様に、Lakeはライブラリから静的バイナリと共有バイナリの両方をビルドすることができます。したがって、ライブラリは ``static`` ファセットと ``shared`` ファセットを持つと言えます。Lakeでは、ユーザーがモジュールやパッケージからビルドされる独自のカスタムファセットを定義することもできますが、現在、この機能は実験的なもので、まだドキュメント化されていません。

* *trace*(**トレース**)は、与えられたターゲットが最新かどうかを検証するために使われるデータの一部(一般的にはハッシュ)です。ビルドされたターゲットと一緒に保存されたトレースが、ビルド中に計算されたトレースと一致する場合、ターゲットは最新であるとみなされます。ターゲットのトレースは様々な**入力**(ソースファイル、Leanツールチェーン、インポートファイルなど)から導き出されます。
-->

## 参考資料

[leanprover/lake: Lean 4 build system and package manager with configuration files written in Lean.](https://github.com/leanprover/lake) : 翻訳元、公式。``README.md`` に詳細な情報が書かれています。
